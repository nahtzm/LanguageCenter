{% extends "/layout/dashboard_base.html" %}
{% block title %}ÄÄƒng kÃ½ lá»›p há»c{% endblock %}

{% block dashboard_content %}
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- LEFT: CLASS LIST -->
    <div class="lg:col-span-2 card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-6">Danh sÃ¡ch lá»›p há»c Ä‘ang má»Ÿ</h2>

        <div class="mt-4 space-y-4 max-h-96 overflow-y-auto pr-2">
          {% if classes %}
            {% for c in classes %}
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center p-5 border border-base-300 rounded-xl hover:bg-base-200 transition">
                <div class="flex-1 mb-4 sm:mb-0">
                  <p class="font-bold text-lg">
                    {{ c.name }} â€“ {{ c.course.name }} ({{ c.level.name }})
                  </p>
                  <p class="text-sm opacity-80 mt-1">
                    <span class="font-medium">{{ c.current_students }}/{{ c.max_students }}</span> há»c viÃªn Â·
                    {{ c.start_date.strftime('%d/%m/%Y') }} â†’ {{ c.end_date.strftime('%d/%m/%Y') }}
                  </p>
                  {% if c.teacher %}
                    <p class="text-sm opacity-70 mt-1">
                      GiÃ¡o viÃªn: <span class="font-medium">{{ c.teacher.fullname }}</span>
                    </p>
                  {% else %}
                    <p class="text-sm opacity-70 mt-1">GiÃ¡o viÃªn: ChÆ°a phÃ¢n cÃ´ng</p>
                  {% endif %}
                </div>

                <div class="w-full sm:w-auto">
                  {% if c.id in enrolled_class_ids %}
                    <button class="btn btn-sm btn-outline btn-disabled w-full sm:w-auto" disabled>
                      âœ“ ÄÃ£ Ä‘Äƒng kÃ½
                    </button>
                  {% elif c.current_students >= c.max_students %}
                    <span class="badge badge-error badge-lg">Lá»›p Ä‘Ã£ Ä‘áº§y</span>
                  {% else %}
                    <form method="POST" action="{{ url_for('student.enroll', class_id=c.id) }}" class="inline">
                      {{ csrf_token() if csrf_token else '' }}
                      <button type="submit" class="btn btn-success btn-sm w-full sm:w-auto">
                        ÄÄƒng kÃ½
                      </button>
                    </form>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-center py-12 opacity-60">
              <p class="text-lg">KhÃ´ng tÃ¬m tháº¥y lá»›p há»c nÃ o phÃ¹ há»£p vá»›i bá»™ lá»c</p>
              <p class="text-sm mt-2">HÃ£y thá»­ thay Ä‘á»•i Ä‘iá»u kiá»‡n tÃ¬m kiáº¿m</p>
            </div>
          {% endif %}
        </div>

        <div class="mt-8 pt-6 border-t border-base-300">
          <div class="text-sm opacity-70 space-y-1">
            <p>ğŸ“ Hotline: 0987 456 321</p>
            <p>âœ‰ï¸ Email: trungtamttk@gmail.com</p>
            <p>ğŸ“ Äá»‹a chá»‰: 123 ÄÆ°á»ng ABC, Quáº­n 1, TP.HCM</p>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: FILTER -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="text-xl font-bold text-center mb-6">Bá»™ lá»c lá»›p há»c</h2>

        <form method="GET" class="space-y-5">
          <div>
            <label class="label">
              <span class="label-text font-medium">KhÃ³a há»c</span>
            </label>
            <select name="course_id" class="select select-bordered w-full">
              <option value="">Táº¥t cáº£ khÃ³a há»c</option>
              {% for course in courses %}
                <option value="{{ course.id }}"
                        {% if request.args.get('course_id') == course.id|string %}selected{% endif %}>
                  {{ course.name }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="label">
              <span class="label-text font-medium">Cáº¥p Ä‘á»™</span>
            </label>
            <select name="level_id" class="select select-bordered w-full">
              <option value="">Táº¥t cáº£ cáº¥p Ä‘á»™</option>
              {% for level in levels %}
                <option value="{{ level.id }}"
                        {% if request.args.get('level_id') == level.id|string %}selected{% endif %}>
                  {{ level.name }}
                </option>
              {% endfor %}
            </select>
          </div>

          <button type="submit" class="btn btn-primary w-full mt-4">
            TÃ¬m lá»›p há»c
          </button>
        </form>
      </div>
    </div>
  </div>
{% endblock %}